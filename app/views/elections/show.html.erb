<!-- app/views/elections/show.html.erb -->
<div class="container-fluid py-4">
  <div class="container">
    <div class="text-center mb-4">
      <h1 class="display-4"><%= @election.name %></h1>
      <h4 class="text-muted"><%= @election.election_date.strftime("%B %-d, %Y") %></h4>
    </div>

    <% if user_signed_in? %>
      <%= render 'elections/admin_controls', election: @election if current_user.admin? %>
      
      <!-- Search Bar - Full Width -->
      <div class="mb-4">
        <%= render 'elections/search_bar' %>
      </div>

      <!-- Stats Card - Full Width -->
      <% if @election.election_updates.any? %>
        <div class="mb-4">
          <%= render 'elections/latest_update', election: @election %>
        </div>
      <% end %>

      <%= render 'elections/guide' %>
      <%= render 'elections/contests_list', contests: @contests %>
    <% else %>
      <%= render 'elections/signup_prompt' %>
    <% end %>
  </div>
</div>

<!-- Add JavaScript at bottom of page -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('contestSearch');
    if (searchInput) {
      searchInput.addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase().trim();
        
        // Get only the contest cards by targeting only cards within the contests list
        const contestCards = document.querySelectorAll('#contests-list .card');
        
        contestCards.forEach(card => {
          const contestText = card.textContent.toLowerCase();
          
          if (contestText.includes(searchTerm)) {
            card.style.display = '';
          } else {
            card.style.display = 'none';
          }
        });
      });
    }
  });
</script>