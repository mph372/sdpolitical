
<div class="wrapper">
<div class="row ">

    <div class="col-md order-2 d-none d-md-table-cell text-right">
        <%= link_to "Export District (PDF)", district_path(@district, format: "pdf"), :class => "btn btn-primary float-end" %>
  </div>
  <div class="col-md order-1">
    <h3 class="mb-0 mt-2 header-text text-nowrap nounderline"><%= link_to "#{@district.jurisdiction.name}", @district.jurisdiction %></h4>
    <h1 class="heavy primary-blue text-nowrap"><%= @district.district_name %> </h1>
    
    <% if @district.at_large_district? && user_signed_in? && current_user.admin?  %>
    <p>(Term Expires: <%= @district.term_expires %>)</p>
    <%end%>
  
  </div>



</div>
</div>     
    <br>

<div class="row">
  <!-- Incumbent Card -->
  <div class="<%= @district.district_map.present? ? 'col-lg-5' : 'col-12' %>">
    <div class="">
      <%= render 'incumbent' %>
    </div>
  </div>

  <!-- District Map - Only show if map is present -->
  <% if @district.district_map.present? %>
    <div class="col-lg-7">
      <div class="card rounded primary-border">
          <div class="card-header">
            <span>District Map</span>
          </div>
        <div class="card-body">
          <%= image_tag @district.district_map.url, alt: "District map", class: "img-fluid" %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<div class="row">
    <!-- Analysis Text -->
    <% if @district.note.present? %>
      <div class="col-12 mt-3">
        <div class="card">
          <div class="card-header">
            <span>District Analysis</span>
          </div>
          <div class="card-body">
            <div id="short-note">
              <%= simple_format(truncate(@district.note, length: 500, escape: false, separator: ' ')) %> 
              <% if @district.note.length > 500 %>
                <a href="#" onclick="toggleNote(); return false;">...Read More</a>
              <% end %>
            </div>
            <div id="full-note" class="d-none">
              <%= simple_format(@district.note) %> <a href="#" onclick="toggleNote(); return false;">Read Less</a>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>








  <div class="row">
    <div class="col">
      <% if @district.at_large_district == false %>
        <% if @district.campaigns.active.present?%>
        <%= render partial: 'shared/candidates', locals: {district: @district, candidates: @district.campaigns.active.last.candidates, campaign: @district.campaigns.active.last}%>
        <%end%>
      <%else %>
        <% if @district.jurisdiction.campaigns.active.present?%>
        <%= render partial: 'shared/candidates', locals: {district: @district, candidates: @district.jurisdiction.campaigns.active.last.candidates, campaign: @district.jurisdiction.campaigns.active.last}%>
        <%end%>
      <%end%>
    </div>
  </div>



  <% if @district.statistical_datum.present? || @district.jurisdiction.statistical_datum.present? %>
  <div class="row">
    <div class="col">
    <% if @district.at_large_district == false %>
    <%= render 'redistricting_data'%>
    <hr>
    <%end%>
    
    </div>
  </div>
  <%end%>  




<%if @district.at_large_district == false %>
  <% if @district.campaigns.historic.present? %> 
    <div class="row">
      <div class="col">
      <%= render partial: 'shared/historical_election', locals: { historical_elections: @district.campaigns.historic.order("election_date desc"), show_district: false } %> 
      </div>   
    </div>
  <% end %>
<%else%>
  <% if @district.jurisdiction.campaigns.historic.present? %> 
    <div class="row">
      <div class="col">
      <%= render partial: 'shared/historical_election', locals: { historical_elections: @district.jurisdiction.campaigns.historic.order("election_date desc"), show_district: false } %> 
      </div>   
    </div>
  <%end%>
<%end%>

<div class="row">
 <div class="col float-end">


      <%= link_to "Help", '/pages/about_districts', :class => "btn btn-outline-secondary float-end align-bottom mt-auto", :target => "_blank"%>
    </div>
</div>
  
<%= render 'admin' %>

 <script>
  function toggleNote() {
    var shortNote = document.getElementById('short-note');
    var fullNote = document.getElementById('full-note');
    shortNote.classList.toggle('d-none');
    fullNote.classList.toggle('d-none');
  }
</script>